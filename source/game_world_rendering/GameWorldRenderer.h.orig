#pragma once

#include <QObject>

#include <glow/ref_ptr.h>

#include <Renderer.h>

#include "CuboidDrawable.h"
#include "CaveDrawable.h"
#include "Painter.h"
#include "CavePainter.h"
#include "RenderCamera.h"
#include "HUD.h"

namespace glow
{
    class FrameBufferObject;
    class Texture;
    class Program;
}

namespace glowutils
{
    class ScreenAlignedQuad;
}

class Canvas;
class GameMechanics;
class SSAO;

class GameWorldRenderer : public Renderer
{
public:
    GameWorldRenderer(GameMechanics & gameMechanics);
    virtual ~GameWorldRenderer();

    void initialize() override;
    void resize(int width, int height) override;
    void render(float devicePixelRatio) override;

protected:
    void initializeGBuffer();

protected:
    static const float nearPlane;
    static const float farPlane;
    
    CavePainter m_cavePainter;
    GameLogic & m_gameLogic;
    Canvas & m_canvas;
    
    Painter m_painter;
    RenderCamera m_camera;
    HUD m_hud;

    CuboidDrawable m_cuboidDrawable;
    CaveDrawable m_caveDrawable;

<<<<<<< HEAD:source/rendering/Renderer.h
=======
    GameMechanics & m_gameMechanics;

>>>>>>> origin/menu_33:source/game_world_rendering/GameWorldRenderer.h
    glow::ref_ptr<glow::Program> m_DepthProgram;
    glow::ref_ptr<glow::FrameBufferObject> m_gBufferFBO;
    glow::ref_ptr<glow::Texture> m_gBufferDepth;
    glow::ref_ptr<glow::Texture> m_gBufferNormals;
    glow::ref_ptr<glow::Texture> m_gBufferColor;
    glow::ref_ptr<glow::Texture> m_ssaoOutput;
    glow::ref_ptr<glowutils::ScreenAlignedQuad> m_quad;
    glow::ref_ptr<SSAO> m_ssao;
};
